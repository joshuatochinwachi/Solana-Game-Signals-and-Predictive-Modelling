import React, { useState } from 'react';
import { GamerActivationFeature } from '../components/features/analytics/GamerActivation';
import { GamerRetentionFeature } from '../components/features/analytics/GamerRetention';
import { GamerReactivationFeature } from '../components/features/analytics/GamerReactivation';
import { GamerDeactivationFeature } from '../components/features/analytics/GamerDeactivation';
import { HighRetentionUsersFeature } from '../components/features/analytics/HighRetentionUsers';
import { HighRetentionSummaryFeature } from '../components/features/analytics/HighRetentionSummary';
import { GamersByGamesPlayedFeature } from '../components/features/analytics/GamersByGamesPlayed';
import { CrossGameGamersFeature } from '../components/features/analytics/CrossGameGamers';
import { GamingActivityTotalFeature } from '../components/features/analytics/GamingActivityTotal';
import { DailyGamingActivityFeature } from '../components/features/analytics/DailyGamingActivity';
import { UserDailyActivityFeature } from '../components/features/analytics/UserDailyActivity';
import { ChurnPredictionsFeature } from '../components/features/ml/ChurnPredictions';
import { HighRiskUsersFeature } from '../components/features/ml/HighRiskUsers';
import { ChurnByGameFeature } from '../components/features/ml/ChurnByGame';
import { ModelInfoFeature } from '../components/features/ml/ModelInfo';
import { EliteGamerScroller } from '../components/ui/EliteGamerScroller';
import { GlobalKPIs } from '../components/features/GlobalKPIs';
import { LiveAlerts } from '../components/features/LiveAlerts';
import { Tabs } from '../components/ui/Tabs';
import { ErrorBoundary } from '../components/ErrorBoundary';
import { TestChart } from '../components/TestChart';
import { Info } from 'lucide-react';

const tabs = [
    { id: 'overview', label: 'Overview', icon: 'ðŸ“Š' },
    { id: 'lifecycle', label: 'User Lifecycle', icon: 'ðŸ”„' },
    { id: 'engagement', label: 'Engagement', icon: 'ðŸŽ®' },
    { id: 'activity', label: 'Activity & Volume', icon: 'âš¡' },
    { id: 'predictions', label: 'ML Predictions', icon: 'ðŸ¤–' },
];

export const DashboardPage: React.FC = () => {
    const [activeTab, setActiveTab] = useState('overview');

    return (
        <ErrorBoundary>
            <div className="space-y-8 pb-20">
                {/* Data Scope Notice */}
                <div className="bg-gradient-to-r from-solana-purple/10 via-solana-cyan/10 to-solana-purple/10 border border-solana-purple/30 rounded-xl p-4 backdrop-blur-sm">
                    <div className="flex items-start gap-3">
                        <Info className="w-5 h-5 text-solana-cyan mt-0.5 flex-shrink-0" />
                        <div>
                            <h4 className="font-bold text-white mb-1">ðŸ“Š Data Scope & Methodology</h4>
                            <p className="text-sm text-text-secondary leading-relaxed">
                                All metrics and analytics displayed on this dashboard represent data from the <strong className="text-solana-cyan">last 60 days</strong>.
                                This timeframe ensures optimal performance and relevance while managing the substantial volume of Solana blockchain gaming data.
                                Machine learning predictions and trend analyses are calibrated specifically for this 60-day window to provide the most accurate and actionable insights.
                            </p>
                        </div>
                    </div>
                </div>

                {/* Elite Gamer Scroller - MANDATORY FEATURE */}
                <EliteGamerScroller />

                {/* Global KPIs */}
                <GlobalKPIs />

                {/* Live Alerts & Recommendations */}
                <LiveAlerts />

                {/* Tabbed Navigation */}
                <Tabs tabs={tabs} activeTab={activeTab} onTabChange={setActiveTab} />

                {/* Tab Content */}
                {activeTab === 'overview' && (
                    <div className="space-y-8">
                        <section className="space-y-4">
                            <h2 className="text-2xl font-gaming font-bold text-transparent bg-clip-text bg-gradient-to-r from-solana-purple to-solana-cyan">
                                Retention & Loyalty Overview
                            </h2>
                            <GamerRetentionFeature />
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <HighRetentionUsersFeature />
                                <HighRetentionSummaryFeature />
                            </div>
                        </section>

                        <section className="space-y-4">
                            <h2 className="text-2xl font-gaming font-bold text-transparent bg-clip-text bg-gradient-to-r from-solana-purple to-solana-cyan">
                                Ecosystem Snapshot
                            </h2>
                            <GamersByGamesPlayedFeature />
                        </section>
                    </div>
                )}

                {activeTab === 'lifecycle' && (
                    <div className="space-y-8">
                        <section className="space-y-4">
                            <h2 className="text-2xl font-gaming font-bold text-transparent bg-clip-text bg-gradient-to-r from-solana-purple to-solana-cyan">
                                User Acquisition & Activation

                                {activeTab === 'engagement' && (
                                    <div className="space-y-8">
                                        <section className="space-y-4">
                                            <h2 className="text-2xl font-gaming font-bold text-transparent bg-clip-text bg-gradient-to-r from-solana-purple to-solana-cyan">
                                                Cross-Game Engagement
                                            </h2>
                                            <CrossGameGamersFeature />
                                        </section>

                                        <section className="space-y-4">
                                            <h2 className="text-2xl font-gaming font-bold text-transparent bg-clip-text bg-gradient-to-r from-solana-purple to-solana-cyan">
                                                Games Played Distribution
                                            </h2>
                                            <GamersByGamesPlayedFeature />
                                        </section>
                                    </div>
                                )}

                                {activeTab === 'activity' && (
                                    <div className="space-y-8">
                                        <section className="space-y-4">
                                            <h2 className="text-2xl font-gaming font-bold text-transparent bg-clip-text bg-gradient-to-r from-solana-purple to-solana-cyan">
                                                Total Activity Metrics
                                            </h2>
                                            <GamingActivityTotalFeature />
                                        </section>

                                        <section className="space-y-4">
                                            <h2 className="text-2xl font-gaming font-bold text-transparent bg-clip-text bg-gradient-to-r from-solana-purple to-solana-cyan">
                                                Daily Activity Trends
                                            </h2>
                                            <DailyGamingActivityFeature />
                                        </section>

                                        <section className="space-y-4">
                                            <h2 className="text-2xl font-gaming font-bold text-transparent bg-clip-text bg-gradient-to-r from-solana-purple to-solana-cyan">
                                                User Activity Log
                                            </h2>
                                            <UserDailyActivityFeature />
                                        </section>
                                    </div>
                                )}

                                {activeTab === 'predictions' && (
                                    <div className="space-y-8">
                                        <section className="space-y-4">
                                            <h2 className="text-2xl font-gaming font-bold text-transparent bg-clip-text bg-gradient-to-r from-solana-purple to-solana-cyan">
                                                Churn Risk Predictions
                                            </h2>
                                            <ChurnPredictionsFeature />
                                        </section>

                                        <section className="space-y-4">
                                            <h2 className="text-2xl font-gaming font-bold text-transparent bg-clip-text bg-gradient-to-r from-solana-purple to-solana-cyan">
                                                High Risk Users
                                            </h2>
                                            <HighRiskUsersFeature />
                                        </section>

                                        <section className="space-y-4">
                                            <h2 className="text-2xl font-gaming font-bold text-transparent bg-clip-text bg-gradient-to-r from-solana-purple to-solana-cyan">
                                                Churn Analysis by Game
                                            </h2>
                                            <ChurnByGameFeature />
                                        </section>

                                        <section className="space-y-4">
                                            <h2 className="text-2xl font-gaming font-bold text-transparent bg-clip-text bg-gradient-to-r from-solana-purple to-solana-cyan">
                                                ML Model Performance
                                            </h2>
                                            <ModelInfoFeature />
                                        </section>
                                    </div>
                                )}
                            </div>
                        </ErrorBoundary>
                        );
};
